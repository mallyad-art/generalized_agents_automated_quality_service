<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generalized Agents: Automated Quality Dashboard</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      margin: 24px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 14px;
    }

    th {
      background: #f5f5f5;
      text-align: left;
    }

    .toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .toolbar-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .pagination {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      align-items: center;
    }

    input[type="text"] {
      padding: 6px 8px;
      width: 320px;
    }

    button,
    select {
      padding: 6px 10px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .grouping-controls {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 12px;
    }

    .grouping-controls h3 {
      margin: 0 0 8px 0;
      font-size: 14px;
    }

    .status-info {
      background: #e3f2fd;
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .clear-grouping {
      background: #ff6b6b;
      color: white;
      border: none;
    }

    .clear-grouping:hover {
      background: #ff5252;
    }

    a {
      color: #1976d2;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .validation-info {
      font-size: 12px;
      margin-top: 4px;
      padding: 4px 8px;
      border-radius: 3px;
    }

    /* Search highlighting styles */
    mark {
      background-color: #ffeb3b !important;
      padding: 1px 2px !important;
      border-radius: 2px !important;
      font-weight: bold;
    }

    .search-info {
      background: #fff3e0;
      color: #f57c00;
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 12px;
      font-size: 14px;
      border-left: 4px solid #ff9800;
    }

    .validation-success {
      background: #e8f5e8;
      color: #2e7d32;
    }

    .validation-error {
      background: #ffebee;
      color: #c62828;
    }

    .validation-warning {
      background: #fff3e0;
      color: #f57c00;
    }
  </style>
</head>

<body>
  <div class="container">
    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
      <img src="/static/logo.svg" alt="Logo" style="width: 60px; height: 60px;">
      <div>
        <h1 style="margin: 0;">Generalized Agents: Automated Quality Dashboard</h1>
        <p style="margin: 8px 0 0 0; color: #666; font-size: 16px;">
          Real-time insights into Auto-QC and Auto-Reviewer execution results
        </p>
      </div>
    </div>

    <!-- Dashboard Overview -->
    <div
      style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #1976d2;">
      <p style="margin: 0; color: #1976d2; font-size: 14px;">
        üìä <strong>Interactive Data Dashboard:</strong> Search, filter, sort, and analyze your automated quality data
        with real-time insights.
        View individual records or group by time periods to track trends and patterns.
      </p>
    </div>

    <!-- Sheet Selection -->
    {% if available_sheets|length > 1 %}
    <div class="sheet-selector" style="background: #e8f5e8; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
      <h3 style="margin: 0 0 8px 0; font-size: 14px;">üìä Current Sheet: {{ current_sheet }}</h3>
      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        {% for sheet in available_sheets %}
        {% if sheet.name == current_sheet %}
        <span style="padding: 4px 8px; background: #4caf50; color: white; border-radius: 3px; font-size: 12px;">{{
          sheet.display_name }}</span>
        {% else %}
        <a href="/?sheet={{ sheet.name }}&q={{ q }}&page_size={{ page_size }}&sort_column={{ sort_column }}&sort_order={{ sort_order }}"
          style="padding: 4px 8px; background: #f5f5f5; color: #1976d2; border-radius: 3px; font-size: 12px; text-decoration: none;">{{
          sheet.display_name }}</a>
        {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Deduplication Controls -->
    <div class="grouping-controls" style="background: #f0f8ff;">
      <h3>üîÑ Show Distinct Records Only (Remove Duplicate Runs)</h3>
      <p style="margin: 4px 0 8px 0; font-size: 12px; color: #666;">
        Convert from "all individual runs" to "distinct records" by keeping only the latest run per unique key
      </p>
      <div
        style="background: rgba(25, 118, 210, 0.1); padding: 8px; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
        <strong>üéØ Use Case:</strong> Show latest status per unique key, removing duplicate runs and retries.
      </div>
      <form method="get" action="/">
        <input type="hidden" name="q" value="{{ q }}">
        <input type="hidden" name="page_size" value="{{ page_size }}">
        <input type="hidden" name="page" value="1">
        <input type="hidden" name="sheet" value="{{ current_sheet }}">
        <input type="hidden" name="group_by_period" value="{{ group_by_period }}">
        <input type="hidden" name="timestamp_column" value="{{ timestamp_column }}">
        <input type="hidden" name="day_filter" value="{{ day_filter }}">
        <input type="hidden" name="sort_column" value="{{ sort_column }}">
        <input type="hidden" name="sort_order" value="{{ sort_order }}">

        <div class="toolbar-row">
          <select name="dedupe_field">
            <option value="">Select unique key field (e.g., author, colab_name)</option>
            {% for col in all_columns %}
            <option value="{{ col }}" {% if dedupe_field==col %}selected{% endif %}>{{ col }}</option>
            {% endfor %}
          </select>

          <select name="dedupe_timestamp">
            <option value="">Select timestamp field (to keep latest run)</option>
            {% for col in timestamp_columns %}
            <option value="{{ col }}" {% if dedupe_timestamp==col %}selected{% endif %}>{{ col }}</option>
            {% endfor %}
          </select>

          <button type="submit" id="apply-dedupe-btn">Show Distinct Records</button>

          {% if deduplicated %}
          <a href="/?q={{ q }}&page_size={{ page_size }}&sheet={{ current_sheet }}&group_by_period={{ group_by_period }}&timestamp_column={{ timestamp_column }}&day_filter={{ day_filter }}&sort_column={{ sort_column }}&sort_order={{ sort_order }}"
            class="clear-grouping" style="padding: 6px 10px; border-radius: 4px;">Show All Runs</a>
          {% endif %}
        </div>
        <div id="dedupe-validation-info" class="validation-info" style="display: none;"></div>
      </form>
    </div>

    <!-- Sorting Controls -->
    <div class="grouping-controls" style="background: #fff8e1;">
      <h3>üîÑ Sort by Timestamp (Optional)</h3>
      <p style="margin: 4px 0 8px 0; font-size: 12px; color: #666;">
        Sort data by timestamp column - works for individual runs, deduplication, and grouping views
      </p>
      <div
        style="background: rgba(245, 124, 0, 0.1); padding: 8px; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
        <strong>‚è∞ Use Case:</strong> Sort data chronologically - newest first (default) or oldest first.
      </div>
      <form method="get" action="/">
        <input type="hidden" name="q" value="{{ q }}">
        <input type="hidden" name="page_size" value="{{ page_size }}">
        <input type="hidden" name="page" value="1">
        <input type="hidden" name="sheet" value="{{ current_sheet }}">
        <input type="hidden" name="dedupe_field" value="{{ dedupe_field }}">
        <input type="hidden" name="dedupe_timestamp" value="{{ dedupe_timestamp }}">
        <input type="hidden" name="group_by_period" value="{{ group_by_period }}">
        <input type="hidden" name="timestamp_column" value="{{ timestamp_column }}">
        <input type="hidden" name="day_filter" value="{{ day_filter }}">

        <div class="toolbar-row">
          <select name="sort_column">
            <option value="">No sorting</option>
            {% for col in timestamp_columns %}
            <option value="{{ col }}" {% if sort_column==col %}selected{% endif %}>{{ col }}</option>
            {% endfor %}
          </select>

          <select name="sort_order">
            <option value="desc" {% if sort_order=="desc" %}selected{% endif %}>Newest First (Descending)</option>
            <option value="asc" {% if sort_order=="asc" %}selected{% endif %}>Oldest First (Ascending)</option>
          </select>

          <button type="submit" id="apply-sorting-btn">Apply Sorting</button>

          {% if sort_column %}
          <a href="/?q={{ q }}&page_size={{ page_size }}&sheet={{ current_sheet }}&dedupe_field={{ dedupe_field }}&dedupe_timestamp={{ dedupe_timestamp }}&group_by_period={{ group_by_period }}&timestamp_column={{ timestamp_column }}&day_filter={{ day_filter }}"
            class="clear-grouping" style="padding: 6px 10px; border-radius: 4px;">Clear Sorting</a>
          {% endif %}
        </div>
        <div id="sort-validation-info" class="validation-info" style="display: none;"></div>
      </form>
    </div>

    <!-- Grouping Controls -->
    <div class="grouping-controls">
      <h3>üìä Time-based Grouping (Optional)</h3>
      <div
        style="background: rgba(76, 175, 80, 0.1); padding: 8px; border-radius: 4px; margin-bottom: 8px; font-size: 12px;">
        <strong>üìà Use Case:</strong> Group data by time periods to analyze trends and patterns.
      </div>
      <form method="get" action="/">
        <input type="hidden" name="q" value="{{ q }}">
        <input type="hidden" name="page_size" value="{{ page_size }}">
        <input type="hidden" name="page" value="1">
        <input type="hidden" name="sheet" value="{{ current_sheet }}">
        <input type="hidden" name="dedupe_field" value="{{ dedupe_field }}">
        <input type="hidden" name="dedupe_timestamp" value="{{ dedupe_timestamp }}">
        <input type="hidden" name="sort_column" value="{{ sort_column }}">
        <input type="hidden" name="sort_order" value="{{ sort_order }}">

        <div class="toolbar-row">
          <select name="group_by_period">
            <option value="">No grouping</option>
            <option value="day" {% if group_by_period=="day" %}selected{% endif %}>Group by Day</option>
            <option value="week" {% if group_by_period=="week" %}selected{% endif %}>Group by Week</option>
          </select>

          <select name="timestamp_column">
            <option value="">Select timestamp column</option>
            {% for col in timestamp_columns %}
            <option value="{{ col }}" {% if timestamp_column==col %}selected{% endif %}>{{ col }}</option>
            {% endfor %}
          </select>

          <button type="submit" id="apply-grouping-btn">Apply Grouping</button>

          {% if grouped %}
          <a href="/?q={{ q }}&page_size={{ page_size }}&sheet={{ current_sheet }}&dedupe_field={{ dedupe_field }}&dedupe_timestamp={{ dedupe_timestamp }}&sort_column={{ sort_column }}&sort_order={{ sort_order }}&day_filter={{ day_filter }}"
            class="clear-grouping" style="padding: 6px 10px; border-radius: 4px;">Clear Grouping</a>
          {% endif %}
        </div>
        <div id="validation-info" class="validation-info" style="display: none;"></div>
      </form>
    </div>

    <!-- Day Filter Controls (Optional) -->
    <div class="toolbar-section">
      <h3>üìÖ Day Filter (Optional)</h3>
      <p style="margin: 0 0 12px 0; color: #666; font-size: 13px;">
        Filter to show only records from specific time periods based on timestamp values
      </p>
      <form class="toolbar" method="get" action="/">
        <input type="hidden" name="q" value="{{ q }}">
        <input type="hidden" name="page_size" value="{{ page_size }}">
        <input type="hidden" name="sheet" value="{{ current_sheet }}">
        <input type="hidden" name="group_by_period" value="{{ group_by_period }}">
        <input type="hidden" name="dedupe_field" value="{{ dedupe_field }}">
        <input type="hidden" name="dedupe_timestamp" value="{{ dedupe_timestamp }}">
        <input type="hidden" name="sort_column" value="{{ sort_column }}">
        <input type="hidden" name="sort_order" value="{{ sort_order }}">

        <div class="toolbar-row">
          <select name="timestamp_column">
            <option value="">Select timestamp column</option>
            {% for col in timestamp_columns %}
            <option value="{{ col }}" {% if timestamp_column==col %}selected{% endif %}>{{ col }}</option>
            {% endfor %}
          </select>

          <select name="day_filter">
            <option value="">Show all records (no time filter)</option>
            <option value="today" {% if day_filter=="today" %}selected{% endif %}>Today only (since midnight)</option>
            <option value="yesterday" {% if day_filter=="yesterday" %}selected{% endif %}>Yesterday only</option>
            <option value="past_7" {% if day_filter=="past_7" %}selected{% endif %}>Past 7 days (including today)</option>
          </select>

          <button type="submit" id="apply-day-filter-btn">Apply Time Filter</button>

          {% if day_filter %}
          <a href="/?q={{ q }}&page_size={{ page_size }}&sheet={{ current_sheet }}&group_by_period={{ group_by_period }}&timestamp_column={{ timestamp_column }}&dedupe_field={{ dedupe_field }}&dedupe_timestamp={{ dedupe_timestamp }}&sort_column={{ sort_column }}&sort_order={{ sort_order }}"
            class="clear-grouping" style="padding: 6px 10px; border-radius: 4px;">Show All Records</a>
          {% endif %}
        </div>
      </form>
    </div>

    <!-- Search and Pagination Controls -->
    <form class="toolbar" method="get" action="/">
      <input type="hidden" name="group_by_period" value="{{ group_by_period }}">
      <input type="hidden" name="timestamp_column" value="{{ timestamp_column }}">
      <input type="hidden" name="day_filter" value="{{ day_filter }}">
      <input type="hidden" name="dedupe_field" value="{{ dedupe_field }}">
      <input type="hidden" name="dedupe_timestamp" value="{{ dedupe_timestamp }}">
      <input type="hidden" name="sort_column" value="{{ sort_column }}">
      <input type="hidden" name="sort_order" value="{{ sort_order }}">
      <input type="hidden" name="page" value="1">
      <input type="hidden" name="sheet" value="{{ current_sheet }}">

      <input name="q" type="text" placeholder="Search and highlight terms‚Ä¶" value="{{ q }}">
      <select name="page_size">
        {% for size in [10,25,50,100] %}
        <option value="{{size}}" {% if size==page_size %}selected{% endif %}>{{size}} / page</option>
        {% endfor %}
      </select>
      <button type="submit">Search</button>
    </form>

    <!-- Status Information -->
    {% if error_message %}
    <div class="status-info" style="background: #ffebee; color: #c62828; border-left: 4px solid #f44336;">
      ‚ùå Processing Error: {{ error_message }}
    </div>
    {% endif %}

    {% if deduplicated %}
    <div class="status-info" style="background: #e8f5e8; color: #2e7d32; border-left: 4px solid #4caf50;">
      üîÑ <strong>Distinct Records View:</strong> Showing unique records deduplicated by "{{ dedupe_field }}", keeping
      the latest run based on "{{ dedupe_timestamp }}" timestamp. {{ duplicates_removed }} duplicate runs removed ({{
      original_count }} ‚Üí {{ total }} records)

    </div>
    {% endif %}

    {% if grouped %}
    <div class="status-info">
      üìä Data grouped by {{ group_by_period }} using column "{{ timestamp_column }}"
      {% if sort_order == 'asc' %} (sorted oldest first){% else %} (sorted newest first){% endif %}

    </div>
    {% endif %}

    {% if day_filter %}
    <div class="status-info" style="background: #e3f2fd; color: #1976d2; border-left: 4px solid #2196f3;">
      ÔøΩ <strong>Time Filter Active:</strong>
      {% if day_filter == 'today' %}Showing only records from today (since midnight)
      {% elif day_filter == 'yesterday' %}Showing only records from yesterday
      {% elif day_filter == 'past_7' %}Showing records from the past 7 days (including today)
      {% endif %}
      based on timestamps in column "{{ timestamp_column }}"
    </div>
    {% endif %}

    {% if sort_column and not grouped and not deduplicated %}
    <div class="status-info" style="background: #fff8e1; color: #f57c00; border-left: 4px solid #ff9800;">
      üîÑ <strong>Sorted View:</strong> Data sorted by "{{ sort_column }}" timestamp
      {% if sort_order == 'asc' %}(oldest first){% else %}(newest first){% endif %}

    </div>
    {% endif %}

    <!-- Data Type Information -->
    {% if not deduplicated and not grouped %}
    <div class="status-info" style="background: #f3e5f5; color: #7b1fa2; border-left: 4px solid #9c27b0;">
      üìã <strong>Individual Runs View:</strong> Each row represents a separate Auto-QC or Auto-Reviewer execution run

    </div>
    {% endif %}



    <!-- Search Information -->
    {% if q and q.strip() %}
    <div class="search-info">
      üîç Searching for "<strong>{{ q }}</strong>" - matching terms are <mark>highlighted</mark> in results
    </div>
    {% endif %}

    <!-- Data Summary -->
    <div
      style="background: #f8f9fa; padding: 16px; border-radius: 6px; margin-bottom: 16px; border-left: 4px solid #6c757d;">
      <div style="font-weight: bold; margin-bottom: 8px; font-size: 16px;">
        üìä Showing {{ total }}
        {% if deduplicated %}
        distinct records (deduplicated by "{{ dedupe_field }}", latest by "{{ dedupe_timestamp }}")
        {% elif grouped %}
        grouped records
        {% else %}
        individual runs
        {% endif %}
        {% if q and q.strip() %} matching "{{ q }}"{% endif %}
      </div>


    </div>

    <table>
      <caption style="caption-side: top; text-align: left; font-weight: bold; padding: 8px 0; color: #333;">
        {% if deduplicated %}
        üìä Distinct Records (Latest Run Per {{ dedupe_field|title }})
        {% elif grouped %}
        üìà Grouped Data Summary
        {% else %}
        üîÑ All Individual Execution Runs
        {% endif %}
      </caption>
      <thead>
        <tr>
          {% for c in cols %}
          <th>{{ c }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          {% for c in cols %}
          <td>{{ r[c]|safe }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="pagination">
      <form method="get" action="/">
        <input type="hidden" name="q" value="{{ q }}">
        <input type="hidden" name="page_size" value="{{ page_size }}">
        <input type="hidden" name="group_by_period" value="{{ group_by_period }}">
        <input type="hidden" name="timestamp_column" value="{{ timestamp_column }}">
        <input type="hidden" name="day_filter" value="{{ day_filter }}">
        <input type="hidden" name="dedupe_field" value="{{ dedupe_field }}">
        <input type="hidden" name="dedupe_timestamp" value="{{ dedupe_timestamp }}">
        <input type="hidden" name="sort_column" value="{{ sort_column }}">
        <input type="hidden" name="sort_order" value="{{ sort_order }}">
        <input type="hidden" name="sheet" value="{{ current_sheet }}">
        <button name="page" value="{{ 1 }}" {% if page==1 %}disabled{% endif %}>&laquo; First</button>
        <button name="page" value="{{ page - 1 }}" {% if page <=1 %}disabled{% endif %}>Prev</button>
        <span>Page {{ page }} of {{ pages }}</span>
        <button name="page" value="{{ page + 1 }}" {% if page>= pages %}disabled{% endif %}>Next</button>
        <button name="page" value="{{ pages }}" {% if page>= pages %}disabled{% endif %}>Last &raquo;</button>
      </form>
    </div>


  </div>

  <script>
    // Client-side validation for timestamp columns and deduplication
    document.addEventListener('DOMContentLoaded', function () {
      // Grouping validation
      const timestampSelect = document.querySelector('select[name="timestamp_column"]');
      const periodSelect = document.querySelector('select[name="group_by_period"]');
      const validationInfo = document.getElementById('validation-info');

      // Deduplication validation
      const dedupeFieldSelect = document.querySelector('select[name="dedupe_field"]');
      const dedupeTimestampSelect = document.querySelector('select[name="dedupe_timestamp"]');
      const dedupeValidationInfo = document.getElementById('dedupe-validation-info');

      // Sorting validation
      const sortColumnSelect = document.querySelector('select[name="sort_column"]');
      const sortValidationInfo = document.getElementById('sort-validation-info');

      function validateTimestampColumn() {
        const column = timestampSelect.value;
        const period = periodSelect.value;

        if (!column || !period) {
          validationInfo.style.display = 'none';
          return;
        }

        // Show loading state
        validationInfo.className = 'validation-info validation-warning';
        validationInfo.textContent = 'Validating timestamp column...';
        validationInfo.style.display = 'block';

        // Validate the column
        const currentSheet = document.querySelector('input[name="sheet"]')?.value || '';
        fetch(`/api/validate-timestamp?column=${encodeURIComponent(column)}&sheet=${encodeURIComponent(currentSheet)}`)
          .then(response => response.json())
          .then(data => {
            if (data.valid) {
              validationInfo.className = 'validation-info validation-success';
              validationInfo.textContent = `‚úì ${data.message}`;
            } else {
              validationInfo.className = 'validation-info validation-error';
              validationInfo.textContent = `‚úó ${data.message}`;
            }
          })
          .catch(error => {
            validationInfo.className = 'validation-info validation-error';
            validationInfo.textContent = 'Error validating column';
          });
      }

      function validateDedupeTimestampColumn() {
        const dedupeField = dedupeFieldSelect.value;
        const timestampField = dedupeTimestampSelect.value;

        if (!dedupeField || !timestampField) {
          dedupeValidationInfo.style.display = 'none';
          return;
        }

        // Show loading state
        dedupeValidationInfo.className = 'validation-info validation-warning';
        dedupeValidationInfo.textContent = 'Validating deduplication timestamp column...';
        dedupeValidationInfo.style.display = 'block';

        // Validate the timestamp column
        const currentSheet = document.querySelector('input[name="sheet"]')?.value || '';
        fetch(`/api/validate-timestamp?column=${encodeURIComponent(timestampField)}&sheet=${encodeURIComponent(currentSheet)}`)
          .then(response => response.json())
          .then(data => {
            if (data.valid) {
              dedupeValidationInfo.className = 'validation-info validation-success';
              dedupeValidationInfo.textContent = `‚úì Ready to deduplicate by "${dedupeField}" keeping latest by "${timestampField}"`;
            } else {
              dedupeValidationInfo.className = 'validation-info validation-error';
              dedupeValidationInfo.textContent = `‚úó ${data.message}`;
            }
          })
          .catch(error => {
            dedupeValidationInfo.className = 'validation-info validation-error';
            dedupeValidationInfo.textContent = 'Error validating timestamp column';
          });
      }

      function validateSortColumn() {
        const column = sortColumnSelect.value;

        if (!column) {
          sortValidationInfo.style.display = 'none';
          return;
        }

        // Show loading state
        sortValidationInfo.className = 'validation-info validation-warning';
        sortValidationInfo.textContent = 'Validating sort column...';
        sortValidationInfo.style.display = 'block';

        // Validate the column
        const currentSheet = document.querySelector('input[name="sheet"]')?.value || '';
        fetch(`/api/validate-timestamp?column=${encodeURIComponent(column)}&sheet=${encodeURIComponent(currentSheet)}`)
          .then(response => response.json())
          .then(data => {
            if (data.valid) {
              sortValidationInfo.className = 'validation-info validation-success';
              sortValidationInfo.textContent = `‚úì Ready to sort by "${column}" timestamp`;
            } else {
              sortValidationInfo.className = 'validation-info validation-error';
              sortValidationInfo.textContent = `‚úó ${data.message}`;
            }
          })
          .catch(error => {
            sortValidationInfo.className = 'validation-info validation-error';
            sortValidationInfo.textContent = 'Error validating sort column';
          });
      }

      // Validate when timestamp column or period changes
      if (timestampSelect && periodSelect) {
        timestampSelect.addEventListener('change', validateTimestampColumn);
        periodSelect.addEventListener('change', validateTimestampColumn);

        // Initial validation if values are already selected
        if (timestampSelect.value && periodSelect.value) {
          validateTimestampColumn();
        }
      }

      // Validate when deduplication fields change
      if (dedupeFieldSelect && dedupeTimestampSelect) {
        dedupeFieldSelect.addEventListener('change', validateDedupeTimestampColumn);
        dedupeTimestampSelect.addEventListener('change', validateDedupeTimestampColumn);

        // Initial validation if values are already selected
        if (dedupeFieldSelect.value && dedupeTimestampSelect.value) {
          validateDedupeTimestampColumn();
        }
      }

      // Validate when sort column changes
      if (sortColumnSelect) {
        sortColumnSelect.addEventListener('change', validateSortColumn);

        // Initial validation if value is already selected
        if (sortColumnSelect.value) {
          validateSortColumn();
        }
      }
    });
  </script>
</body>

</html>